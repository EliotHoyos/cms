<app-card cardTitle="Nuevo Cliente">
  <a mat-button routerLink="/clients" class="mb-3">
    <i class="ti ti-arrow-left me-1"></i> Volver a lista
  </a>

  @if (error) {
    <div class="alert alert-danger mb-3">{{ error }}</div>
  }

  @if (success) {
    <div class="alert alert-success mb-3">{{ success }}</div>
  }

  <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
    <div class="row">
      <!-- Foto -->
      <div class="col-12 mb-4 text-center">
        <div class="photo-upload">
          @if (previewUrl) {
            <img [src]="previewUrl" alt="Preview" class="photo-preview">
          } @else {
            <div class="photo-placeholder">
              <i class="ti ti-camera" style="font-size: 48px;"></i>
              <p>Seleccionar foto</p>
            </div>
          }
          <input type="file" accept="image/*" (change)="onFileSelected($event)" id="photoInput" hidden>
          <label for="photoInput" mat-raised-button class="mt-2">
            <i class="ti ti-upload me-1"></i> Subir foto
          </label>
        </div>
      </div>

      <!-- Nombre -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="name" placeholder="Ingrese nombre">
          @if (clientForm.get('name')?.hasError('required') && clientForm.get('name')?.touched) {
            <mat-error>El nombre es requerido</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Apellido -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="last_name" placeholder="Ingrese apellido">
          @if (clientForm.get('last_name')?.hasError('required') && clientForm.get('last_name')?.touched) {
            <mat-error>El apellido es requerido</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Tipo de documento -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Tipo de Documento</mat-label>
          <mat-select formControlName="document_type">
            @for (type of documentTypes; track type) {
              <mat-option [value]="type">{{ type }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Número de documento -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Número de Documento</mat-label>
          <input matInput formControlName="document" placeholder="Ingrese documento">
          @if (clientForm.get('document')?.hasError('pattern') && clientForm.get('document')?.touched) {
            <mat-error>
              @if (clientForm.get('document_type')?.value === 'DNI') {
                DNI debe tener 8 dígitos
              } @else {
                RUC debe tener 11 dígitos
              }
            </mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Email -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" type="email" placeholder="correo@ejemplo.com">
          @if (clientForm.get('email')?.hasError('email') && clientForm.get('email')?.touched) {
            <mat-error>Email inválido</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Celular -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Celular</mat-label>
          <input matInput formControlName="cellphome" placeholder="987654321">
          @if (clientForm.get('cellphome')?.hasError('pattern') && clientForm.get('cellphome')?.touched) {
            <mat-error>Celular debe tener 9 dígitos y comenzar con 9</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Dirección -->
      <div class="col-12 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Dirección</mat-label>
          <input matInput formControlName="address" placeholder="Ingrese dirección">
          @if (clientForm.get('address')?.hasError('required') && clientForm.get('address')?.touched) {
            <mat-error>La dirección es requerida</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Género -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Género</mat-label>
          <mat-select formControlName="gender">
            @for (gender of genders; track gender) {
              <mat-option [value]="gender">{{ gender }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Fecha de nacimiento -->
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Fecha de Nacimiento</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="birthday">
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- Botones -->
      <div class="col-12 mt-3">
        <button mat-raised-button color="primary" type="submit" [disabled]="loading">
          @if (loading) {
            <mat-spinner diameter="20" class="me-2"></mat-spinner>
          }
          <i class="ti ti-device-floppy me-1"></i> Guardar Cliente
        </button>
        <a mat-button routerLink="/clients" class="ms-2">Cancelar</a>
      </div>
    </div>
  </form>
</app-card>
